# Docker Compose configuration for Document Reconstruction Pipeline
#
# Usage:
#   docker-compose up        # Start web UI
#   docker-compose up -d     # Start in background
#   docker-compose logs -f   # View logs
#   docker-compose down      # Stop

version: '3.8'

services:
  doc-recon:
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "8080:8080"
    volumes:
      # Mount sample data
      - ./examples:/app/examples:ro
      # Mount output directory
      - ./output:/app/output
      # Mount models directory (for persistence)
      - doc-recon-models:/app/src/models
    environment:
      - DOC_RECON_DEBUG=false
      - DOC_RECON_USE_GPU=false
      # Optional: Mathpix API credentials
      # - MATHPIX_APP_ID=your_app_id
      # - MATHPIX_APP_KEY=your_app_key
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Optional: GPU-enabled service (requires nvidia-docker)
  # doc-recon-gpu:
  #   extends:
  #     service: doc-recon
  #   runtime: nvidia
  #   environment:
  #     - DOC_RECON_USE_GPU=true
  #   deploy:
  #     resources:
  #       reservations:
  #         devices:
  #           - driver: nvidia
  #             count: 1
  #             capabilities: [gpu]

volumes:
  doc-recon-models:
    driver: local

